@using Mythetech.Framework.Components
@using Mythetech.Framework.Components.VirtualizeContainer
@using MudBlazor
@attribute [Stories("Components/VirtualizeContainer")]

<Stories TComponent="VirtualizeContainer<string>">
    <Story Name="Vertical (Default)" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    Default vertical scrolling list with 500 items.
                </MudText>
                <div style="width: 100%; height: 300px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeContainer Items="_indexedItems" ItemSize="40">
                        <ChildContent Context="item">
                            <div style="height: 40px; display: flex; align-items: center; padding: 0 16px; border-bottom: 1px solid var(--mud-palette-lines-default);">
                                <MudText Style="min-width: 60px; color: var(--mud-palette-text-secondary);">@item.Index</MudText>
                                <MudText>@item.Text</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeContainer>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_indexedItems.Count) total items - only visible items are rendered in the DOM
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Horizontal (Experimental)" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    Horizontal scrolling. Note: Blazor's Virtualize component only supports vertical virtualization,
                    so horizontal mode renders all items without virtualization.
                </MudText>
                <div style="width: 100%; height: 80px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeContainer Items="_horizontalItems" ItemSize="120" Orientation="Mythetech.Framework.Components.Enums.Orientation.Horizontal">
                        <ChildContent Context="item">
                            <div style="width: 120px; height: 100%; display: flex; align-items: center; justify-content: center; border-right: 1px solid var(--mud-palette-lines-default);">
                                <MudText>@item</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeContainer>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_horizontalItems.Count) total items
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Resizable Container" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    Resize the container to see virtualization adapt. The component uses ResizeObserver to detect changes.
                </MudText>
                <MudStack Row AlignItems="AlignItems.Center" Spacing="2">
                    <MudText Typo="Typo.body2">Width:</MudText>
                    <MudSlider @bind-Value="_containerWidthPercent" Min="30" Max="100" Step="5" Color="Color.Primary" Style="width: 150px;" />
                    <MudText Typo="Typo.body2">@(_containerWidthPercent)%</MudText>
                </MudStack>
                <MudStack Row AlignItems="AlignItems.Center" Spacing="2">
                    <MudText Typo="Typo.body2">Height:</MudText>
                    <MudSlider @bind-Value="_containerHeight" Min="150" Max="500" Step="25" Color="Color.Primary" Style="width: 150px;" />
                    <MudText Typo="Typo.body2">@(_containerHeight)px</MudText>
                </MudStack>
                <div style="width: @(_containerWidthPercent)%; height: @(_containerHeight)px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeContainer Items="_indexedItems" ItemSize="40" @key="_containerHeight">
                        <ChildContent Context="item">
                            <div style="height: 40px; display: flex; align-items: center; padding: 0 16px; border-bottom: 1px solid var(--mud-palette-lines-default);">
                                <MudText Style="min-width: 60px; color: var(--mud-palette-text-secondary);">@item.Index</MudText>
                                <MudText>@item.Text</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeContainer>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_indexedItems.Count) total items
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Large Dataset" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    Efficiently renders 10,000 items with virtualization.
                </MudText>
                <div style="width: 100%; height: 400px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeContainer Items="_indexedLargeDataset" ItemSize="32" OverscanCount="5">
                        <ChildContent Context="item">
                            <div style="height: 32px; display: flex; align-items: center; padding: 0 16px; border-bottom: 1px solid var(--mud-palette-lines-default);">
                                <MudText Typo="Typo.body2" Style="min-width: 80px; color: var(--mud-palette-text-secondary);">@item.Index</MudText>
                                <MudText Typo="Typo.body2">@item.Text</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeContainer>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_indexedLargeDataset.Count.ToString("N0")) total items
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Horizontal (Scroll-Based)" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudAlert Severity="Severity.Info" Dense="true">
                    <strong>Experimental:</strong> Scroll-based horizontal virtualization using scroll position tracking.
                </MudAlert>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    This implementation calculates visible items based on scroll position. Only visible items + overscan are rendered.
                </MudText>
                <div style="width: 100%; height: 100px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <HorizontalVirtualizer Items="_horizontalItems" ItemSize="120" OverscanCount="3">
                        <ChildContent Context="item">
                            <div style="width: 120px; height: 100%; display: flex; align-items: center; justify-content: center; border-right: 1px solid var(--mud-palette-lines-default); background: var(--mud-palette-background);">
                                <MudText>@item</MudText>
                            </div>
                        </ChildContent>
                    </HorizontalVirtualizer>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_horizontalItems.Count) total items - check DevTools to verify only visible items are in DOM
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Horizontal Large Dataset" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudAlert Severity="Severity.Info" Dense="true">
                    <strong>Experimental:</strong> 1,000 items with scroll-based horizontal virtualization.
                </MudAlert>
                <div style="width: 100%; height: 120px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <HorizontalVirtualizer Items="_largeHorizontalItems" ItemSize="100" OverscanCount="5">
                        <ChildContent Context="item">
                            <div style="width: 100px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 1px solid var(--mud-palette-lines-default); background: var(--mud-palette-background);">
                                <MudText Typo="Typo.caption" Color="Color.Secondary">@item.Index</MudText>
                                <MudText Typo="Typo.body2">@item.Text</MudText>
                            </div>
                        </ChildContent>
                    </HorizontalVirtualizer>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_largeHorizontalItems.Count.ToString("N0")) total items - scroll to verify smooth performance
                </MudText>
            </MudStack>
        </Template>
    </Story>
</Stories>

@code {
    private double _containerWidthPercent = 100;
    private double _containerHeight = 300;

    private record IndexedItem(int Index, string Text);

    private List<IndexedItem> _indexedItems = Enumerable.Range(1, 500).Select(i => new IndexedItem(i, $"Item {i}")).ToList();
    private List<string> _horizontalItems = Enumerable.Range(1, 100).Select(i => $"Card {i}").ToList();
    private List<IndexedItem> _indexedLargeDataset = Enumerable.Range(1, 10000).Select(i => new IndexedItem(i, "Sample data entry")).ToList();
    private List<IndexedItem> _largeHorizontalItems = Enumerable.Range(1, 1000).Select(i => new IndexedItem(i, $"Card {i}")).ToList();
}
