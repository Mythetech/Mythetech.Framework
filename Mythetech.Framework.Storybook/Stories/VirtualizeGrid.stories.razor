@using Mythetech.Framework.Components.VirtualizeGrid
@using MudBlazor
@attribute [Stories("Components/VirtualizeGrid")]

<Stories TComponent="VirtualizeGrid<string>">
    <Story Name="Basic Grid" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudAlert Severity="Severity.Info" Dense="true">
                    <strong>Experimental:</strong> 2D virtualization for grid layouts.
                </MudAlert>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    A 10x50 grid (500 cells) with both horizontal and vertical virtualization.
                </MudText>
                <div style="width: 100%; height: 300px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeGrid Items="_basicGridItems" ColumnCount="10" RowHeight="40" ColumnWidth="100" OverscanCount="2">
                        <ChildContent Context="item">
                            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; border: 1px solid var(--mud-palette-lines-default); background: var(--mud-palette-background); box-sizing: border-box;">
                                <MudText Typo="Typo.body2">@item</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeGrid>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_basicGridItems.Count) total cells - only visible cells are rendered
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Large Grid (SQL Results)" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudAlert Severity="Severity.Info" Dense="true">
                    <strong>Experimental:</strong> Simulating a SQL results panel with 10,000 rows x 20 columns = 200,000 cells.
                </MudAlert>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    This demonstrates the use case for displaying large query results. Scroll both horizontally and vertically.
                </MudText>
                <div style="width: 100%; height: 400px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeGrid Items="_sqlResultItems" ColumnCount="20" RowHeight="32" ColumnWidth="120" OverscanCount="3">
                        <ChildContent Context="item">
                            <div style="width: 100%; height: 100%; display: flex; align-items: center; padding: 0 8px; border: 1px solid var(--mud-palette-lines-default); background: var(--mud-palette-background); box-sizing: border-box; overflow: hidden;">
                                <MudText Typo="Typo.body2" Style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">@item</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeGrid>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_sqlResultItems.Count.ToString("N0")) total cells - check DevTools to verify only visible cells are in DOM
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Resizable Grid" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudAlert Severity="Severity.Info" Dense="true">
                    <strong>Experimental:</strong> Resizable container with 2D virtualization.
                </MudAlert>
                <MudStack Row AlignItems="AlignItems.Center" Spacing="2">
                    <MudText Typo="Typo.body2">Width:</MudText>
                    <MudSlider @bind-Value="_gridWidthPercent" Min="30" Max="100" Step="5" Color="Color.Primary" Style="width: 150px;" />
                    <MudText Typo="Typo.body2">@(_gridWidthPercent)%</MudText>
                </MudStack>
                <MudStack Row AlignItems="AlignItems.Center" Spacing="2">
                    <MudText Typo="Typo.body2">Height:</MudText>
                    <MudSlider @bind-Value="_gridHeight" Min="150" Max="500" Step="25" Color="Color.Primary" Style="width: 150px;" />
                    <MudText Typo="Typo.body2">@(_gridHeight)px</MudText>
                </MudStack>
                <div style="width: @(_gridWidthPercent)%; height: @(_gridHeight)px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeGrid Items="_basicGridItems" ColumnCount="10" RowHeight="40" ColumnWidth="100" OverscanCount="2">
                        <ChildContent Context="item">
                            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; border: 1px solid var(--mud-palette-lines-default); background: var(--mud-palette-background); box-sizing: border-box;">
                                <MudText Typo="Typo.body2">@item</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeGrid>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    Resize the container to see virtualization adapt dynamically
                </MudText>
            </MudStack>
        </Template>
    </Story>

    <Story Name="Numbered Cells" Layout="typeof(DefaultMudLayout)">
        <Template>
            <MudStack Spacing="4">
                <MudAlert Severity="Severity.Info" Dense="true">
                    <strong>Experimental:</strong> Grid with row/column coordinates for debugging.
                </MudAlert>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">
                    Each cell shows its row and column index. Useful for verifying correct positioning during scroll.
                </MudText>
                <div style="width: 100%; height: 350px; border: 1px dashed var(--mud-palette-lines-default); border-radius: 4px; overflow: hidden;">
                    <VirtualizeGrid Items="_coordinateItems" ColumnCount="15" RowHeight="50" ColumnWidth="80" OverscanCount="2">
                        <ChildContent Context="item">
                            <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid var(--mud-palette-lines-default); background: var(--mud-palette-background); box-sizing: border-box;">
                                <MudText Typo="Typo.caption" Color="Color.Secondary">@item.Row, @item.Col</MudText>
                                <MudText Typo="Typo.body2">@item.Index</MudText>
                            </div>
                        </ChildContent>
                    </VirtualizeGrid>
                </div>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(_coordinateItems.Count.ToString("N0")) total cells
                </MudText>
            </MudStack>
        </Template>
    </Story>
</Stories>

@code {
    private double _gridWidthPercent = 100;
    private double _gridHeight = 300;

    // Basic 10x50 grid
    private List<string> _basicGridItems = Enumerable.Range(0, 500)
        .Select(i => $"Cell {i}")
        .ToList();

    // Large SQL-like results: 10,000 rows x 20 columns
    private List<string> _sqlResultItems = Enumerable.Range(0, 200000)
        .Select(i =>
        {
            var row = i / 20;
            var col = i % 20;
            return col == 0 ? $"Row {row}" : $"Data_{row}_{col}";
        })
        .ToList();

    // Coordinate items for debugging
    private record CoordinateItem(int Index, int Row, int Col);
    private List<CoordinateItem> _coordinateItems = Enumerable.Range(0, 1500)
        .Select(i => new CoordinateItem(i, i / 15, i % 15))
        .ToList();
}
