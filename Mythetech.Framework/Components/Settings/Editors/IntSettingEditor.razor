@using System.Reflection
@using MudBlazor
@using Mythetech.Framework.Infrastructure.Settings

@if (Attribute.HasRange)
{
    <div class="mf-setting-slider-container">
        <MudSlider T="int"
                   Value="@GetValue()"
                   ValueChanged="@OnValueChangedAsync"
                   Min="@((int)Attribute.Min)"
                   Max="@((int)Attribute.Max)"
                   Step="@((int)Attribute.Step)"
                   Color="Color.Primary"
                   Class="mf-setting-slider">
        </MudSlider>
        <MudText Typo="Typo.body2" Class="mf-setting-slider-value">@GetValue()</MudText>
    </div>
}
else
{
    <MudNumericField T="int"
                     Value="@GetValue()"
                     ValueChanged="@OnValueChangedAsync"
                     Variant="Variant.Outlined"
                     Margin="Margin.Dense"
                     Class="mf-setting-numeric" />
}

@code {
    [Parameter, EditorRequired]
    public SettingsBase Settings { get; set; } = default!;

    [Parameter, EditorRequired]
    public PropertyInfo Property { get; set; } = default!;

    [Parameter, EditorRequired]
    public SettingAttribute Attribute { get; set; } = default!;

    [Parameter]
    public EventCallback OnValueChanged { get; set; }

    private int GetValue() => (int)(Property.GetValue(Settings) ?? 0);

    private async Task OnValueChangedAsync(int value)
    {
        Property.SetValue(Settings, value);
        await OnValueChanged.InvokeAsync();
    }
}
